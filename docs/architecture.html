<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MirixClient → REST API → Server Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: #252526;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
        }

        .header {
            background: #007acc;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .nav {
            background: #2d2d30;
            padding: 15px;
            display: flex;
            gap: 5px;
            border-bottom: 1px solid #3e3e42;
        }

        .nav-button {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid #3e3e42;
            color: #d4d4d4;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Consolas', monospace;
            font-size: 0.85em;
        }

        .nav-button:hover {
            background: #3e3e42;
            border-color: #007acc;
        }

        .nav-button.active {
            background: #007acc;
            border-color: #007acc;
            color: white;
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .architecture-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .component-box {
            background: #1e1e1e;
            border: 2px solid #3e3e42;
            border-radius: 8px;
            padding: 20px;
            height: fit-content;
        }

        .component-box h3 {
            color: #4ec9b0;
            font-size: 1.1em;
            margin-bottom: 5px;
            font-weight: 400;
        }

        .component-box .file-path {
            color: #858585;
            font-size: 0.75em;
            margin-bottom: 20px;
            display: block;
        }

        .method-list {
            margin-top: 15px;
        }

        .method {
            background: #2d2d30;
            padding: 10px;
            margin: 8px 0;
            border-left: 3px solid #007acc;
            border-radius: 3px;
            font-size: 0.85em;
            transition: all 0.2s;
            cursor: pointer;
        }

        .method:hover {
            background: #3e3e42;
            border-left-color: #4ec9b0;
            transform: translateX(5px);
        }

        .method-name {
            color: #dcdcaa;
            font-weight: 600;
        }

        .method-type {
            color: #4ec9b0;
            font-size: 0.8em;
            margin-right: 10px;
        }

        .method-desc {
            color: #858585;
            font-size: 0.8em;
            margin-top: 5px;
        }

        .endpoint {
            background: #2d2d30;
            padding: 12px;
            margin: 10px 0;
            border-left: 3px solid #ce9178;
            border-radius: 3px;
            font-size: 0.85em;
        }

        .endpoint-method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: 600;
            font-size: 0.75em;
            margin-right: 10px;
        }

        .endpoint-method.get { background: #4ec9b0; color: #000; }
        .endpoint-method.post { background: #ce9178; color: #000; }
        .endpoint-method.patch { background: #dcdcaa; color: #000; }
        .endpoint-method.delete { background: #f48771; color: #000; }

        .endpoint-path {
            color: #ce9178;
            font-weight: 600;
        }

        .endpoint-desc {
            color: #858585;
            font-size: 0.8em;
            margin-top: 5px;
        }

        .flow-diagram {
            background: #1e1e1e;
            border: 2px solid #3e3e42;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: #2d2d30;
            border-radius: 5px;
            border-left: 4px solid #007acc;
        }

        .flow-step-number {
            background: #007acc;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .flow-arrow {
            text-align: center;
            color: #007acc;
            font-size: 1.5em;
            margin: 10px 0;
        }

        .code-block {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
            font-size: 0.85em;
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .code-block .keyword { color: #569cd6; }
        .code-block .string { color: #ce9178; }
        .code-block .function { color: #dcdcaa; }
        .code-block .comment { color: #6a9955; }
        .code-block .variable { color: #9cdcfe; }

        .mapping-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.85em;
        }

        .mapping-table th {
            background: #2d2d30;
            padding: 12px;
            text-align: left;
            border: 1px solid #3e3e42;
            color: #4ec9b0;
        }

        .mapping-table td {
            padding: 12px;
            border: 1px solid #3e3e42;
            background: #1e1e1e;
        }

        .mapping-table td:first-child {
            color: #dcdcaa;
            font-weight: 600;
        }

        .mapping-table td:nth-child(2) {
            color: #ce9178;
        }

        .mapping-table td:nth-child(3) {
            color: #4ec9b0;
        }

        .highlight {
            color: #4fc3f7;
        }

        .section-title {
            color: #4ec9b0;
            font-size: 1.5em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3e3e42;
        }

        .info-box {
            background: #264f78;
            border-left: 4px solid #007acc;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-box strong {
            color: #4fc3f7;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: #2d2d30;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid #3e3e42;
        }

        .stat-number {
            font-size: 2em;
            color: #4ec9b0;
            font-weight: 600;
        }

        .stat-label {
            color: #858585;
            font-size: 0.85em;
            margin-top: 5px;
        }

        @media (max-width: 1200px) {
            .architecture-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MIRIXCLIENT → REST API → SERVER</h1>
            <p>Technical Architecture: remote_client.py ↔ rest_api.py ↔ server.py</p>
        </div>

        <div class="nav">
            <button class="nav-button active" onclick="showSection('overview')">OVERVIEW</button>
            <button class="nav-button" onclick="showSection('components')">COMPONENTS</button>
            <button class="nav-button" onclick="showSection('endpoints')">ENDPOINTS</button>
            <button class="nav-button" onclick="showSection('mapping')">METHOD MAPPING</button>
            <button class="nav-button" onclick="showSection('flow')">REQUEST FLOW</button>
        </div>

        <div class="content">
            <!-- Overview Section -->
            <div id="overview" class="section active">
                <h2 class="section-title">System Overview</h2>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">689</div>
                        <div class="stat-label">lines in remote_client.py</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">700+</div>
                        <div class="stat-label">lines in rest_api.py</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">1580</div>
                        <div class="stat-label">lines in server.py</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">30+</div>
                        <div class="stat-label">REST endpoints</div>
                    </div>
                </div>

                <div class="flow-diagram">
                    <h3 style="color: #4ec9b0; margin-bottom: 20px;">Three-Tier Architecture</h3>
                    
                    <div class="flow-step">
                        <div class="flow-step-number">1</div>
                        <div>
                            <strong style="color: #dcdcaa;">MirixClient</strong>
                            <span style="color: #858585; margin-left: 10px;">mirix/client/remote_client.py</span>
                            <div style="color: #858585; font-size: 0.85em; margin-top: 5px;">
                                Client-side HTTP wrapper implementing AbstractClient interface
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓ HTTP/HTTPS</div>

                    <div class="flow-step">
                        <div class="flow-step-number">2</div>
                        <div>
                            <strong style="color: #ce9178;">REST API (FastAPI)</strong>
                            <span style="color: #858585; margin-left: 10px;">mirix/server/rest_api.py</span>
                            <div style="color: #858585; font-size: 0.85em; margin-top: 5px;">
                                HTTP endpoints that route requests to SyncServer
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓ Method Calls</div>

                    <div class="flow-step">
                        <div class="flow-step-number">3</div>
                        <div>
                            <strong style="color: #4ec9b0;">SyncServer</strong>
                            <span style="color: #858585; margin-left: 10px;">mirix/server/server.py</span>
                            <div style="color: #858585; font-size: 0.85em; margin-top: 5px;">
                                Core business logic, manages agents, tools, memory, database
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Key Point:</strong> The REST API (rest_api.py) is a thin wrapper around SyncServer (server.py). 
                    MirixClient makes HTTP requests to REST API endpoints, which then call corresponding SyncServer methods.
                </div>

                <div class="code-block">
<span class="comment"># Example: How a request flows through the system</span>

<span class="comment"># 1. Client makes a call</span>
<span class="variable">client</span> = <span class="function">MirixClient</span>(base_url=<span class="string">"http://localhost:8000"</span>)
<span class="variable">agent</span> = <span class="variable">client</span>.<span class="function">create_agent</span>(name=<span class="string">"test"</span>)

<span class="comment"># 2. MirixClient._request() makes HTTP POST to /agents</span>
<span class="keyword">POST</span> <span class="string">http://localhost:8000/agents</span>
<span class="keyword">Headers:</span> { <span class="string">"Authorization"</span>: <span class="string">"Bearer ..."</span> }
<span class="keyword">Body:</span> { <span class="string">"name"</span>: <span class="string">"test"</span>, ... }

<span class="comment"># 3. FastAPI endpoint receives and routes</span>
@app.<span class="function">post</span>(<span class="string">"/agents"</span>)
<span class="keyword">async def</span> <span class="function">create_agent</span>(request: CreateAgentRequest):
    server = <span class="function">get_server</span>()  <span class="comment"># Get SyncServer instance</span>
    <span class="keyword">return</span> server.<span class="function">create_agent</span>(...)

<span class="comment"># 4. SyncServer processes the request</span>
<span class="keyword">class</span> SyncServer:
    <span class="keyword">def</span> <span class="function">create_agent</span>(self, request, actor):
        agent_state = self.agent_manager.<span class="function">create_agent</span>(...)
        <span class="keyword">return</span> agent_state
                </div>
            </div>

            <!-- Components Section -->
            <div id="components" class="section">
                <h2 class="section-title">Component Details</h2>

                <div class="architecture-row">
                    <!-- MirixClient -->
                    <div class="component-box">
                        <h3>MirixClient</h3>
                        <span class="file-path">mirix/client/remote_client.py</span>

                        <div class="info-box" style="margin-top: 10px; padding: 10px;">
                            HTTP client that implements AbstractClient interface. Makes REST API calls instead of direct method calls.
                        </div>

                        <div class="method-list">
                            <div style="color: #4ec9b0; font-weight: 600; margin-bottom: 10px;">Key Methods:</div>
                            
                            <div class="method">
                                <div class="method-name">__init__(base_url, api_key, ...)</div>
                                <div class="method-desc">Initialize with server URL and auth</div>
                            </div>

                            <div class="method">
                                <div class="method-name">_request(method, endpoint, json)</div>
                                <div class="method-desc">Core HTTP request handler with retries</div>
                            </div>

                            <div class="method">
                                <div class="method-name">list_agents()</div>
                                <div class="method-desc">GET /agents</div>
                            </div>

                            <div class="method">
                                <div class="method-name">create_agent(...)</div>
                                <div class="method-desc">POST /agents</div>
                            </div>

                            <div class="method">
                                <div class="method-name">get_agent(agent_id)</div>
                                <div class="method-desc">GET /agents/{id}</div>
                            </div>

                            <div class="method">
                                <div class="method-name">delete_agent(agent_id)</div>
                                <div class="method-desc">DELETE /agents/{id}</div>
                            </div>

                            <div class="method">
                                <div class="method-name">send_message(...)</div>
                                <div class="method-desc">POST /agents/{id}/messages</div>
                            </div>

                            <div class="method">
                                <div class="method-name">get_messages(agent_id)</div>
                                <div class="method-desc">GET /agents/{id}/messages</div>
                            </div>

                            <div class="method">
                                <div class="method-name">get_in_context_memory(agent_id)</div>
                                <div class="method-desc">GET /agents/{id}/memory</div>
                            </div>

                            <div class="method">
                                <div class="method-name">list_tools()</div>
                                <div class="method-desc">GET /tools</div>
                            </div>

                            <div class="method">
                                <div class="method-name">get_tool(id)</div>
                                <div class="method-desc">GET /tools/{id}</div>
                            </div>

                            <div class="method">
                                <div class="method-name">list_blocks()</div>
                                <div class="method-desc">GET /blocks</div>
                            </div>

                            <div class="method">
                                <div class="method-name">list_model_configs()</div>
                                <div class="method-desc">GET /config/llm</div>
                            </div>

                            <div class="method">
                                <div class="method-name">list_embedding_configs()</div>
                                <div class="method-desc">GET /config/embedding</div>
                            </div>

                            <div style="color: #858585; font-size: 0.85em; margin-top: 15px; text-align: center;">
                                + 30+ more methods...
                            </div>
                        </div>
                    </div>

                    <!-- REST API -->
                    <div class="component-box">
                        <h3>REST API (FastAPI)</h3>
                        <span class="file-path">mirix/server/rest_api.py</span>

                        <div class="info-box" style="margin-top: 10px; padding: 10px;">
                            FastAPI application with HTTP endpoints. Authenticates requests and delegates to SyncServer.
                        </div>

                        <div class="method-list">
                            <div style="color: #4ec9b0; font-weight: 600; margin-bottom: 10px;">Core Functions:</div>
                            
                            <div class="method">
                                <div class="method-name">get_server() → SyncServer</div>
                                <div class="method-desc">Returns singleton SyncServer instance</div>
                            </div>

                            <div class="method">
                                <div class="method-name">authenticate() → AuthContext</div>
                                <div class="method-desc">Validates API key/JWT, returns user context</div>
                            </div>

                            <div style="color: #4ec9b0; font-weight: 600; margin: 20px 0 10px;">Agent Endpoints:</div>

                            <div class="endpoint">
                                <span class="endpoint-method get">GET</span>
                                <span class="endpoint-path">/agents</span>
                                <div class="endpoint-desc">list_agents()</div>
                            </div>

                            <div class="endpoint">
                                <span class="endpoint-method post">POST</span>
                                <span class="endpoint-path">/agents</span>
                                <div class="endpoint-desc">create_agent()</div>
                            </div>

                            <div class="endpoint">
                                <span class="endpoint-method get">GET</span>
                                <span class="endpoint-path">/agents/{agent_id}</span>
                                <div class="endpoint-desc">get_agent()</div>
                            </div>

                            <div class="endpoint">
                                <span class="endpoint-method patch">PATCH</span>
                                <span class="endpoint-path">/agents/{agent_id}</span>
                                <div class="endpoint-desc">update_agent()</div>
                            </div>

                            <div class="endpoint">
                                <span class="endpoint-method delete">DELETE</span>
                                <span class="endpoint-path">/agents/{agent_id}</span>
                                <div class="endpoint-desc">delete_agent()</div>
                            </div>

                            <div style="color: #4ec9b0; font-weight: 600; margin: 20px 0 10px;">Message Endpoints:</div>

                            <div class="endpoint">
                                <span class="endpoint-method post">POST</span>
                                <span class="endpoint-path">/agents/{agent_id}/messages</span>
                                <div class="endpoint-desc">send_message()</div>
                            </div>

                            <div class="endpoint">
                                <span class="endpoint-method get">GET</span>
                                <span class="endpoint-path">/agents/{agent_id}/messages</span>
                                <div class="endpoint-desc">get_agent_messages()</div>
                            </div>

                            <div style="color: #4ec9b0; font-weight: 600; margin: 20px 0 10px;">Memory Endpoints:</div>

                            <div class="endpoint">
                                <span class="endpoint-method get">GET</span>
                                <span class="endpoint-path">/agents/{agent_id}/memory</span>
                                <div class="endpoint-desc">get_agent_memory()</div>
                            </div>

                            <div class="endpoint">
                                <span class="endpoint-method get">GET</span>
                                <span class="endpoint-path">/agents/{agent_id}/memory/archival</span>
                                <div class="endpoint-desc">get_archival_memory_summary()</div>
                            </div>

                            <div class="endpoint">
                                <span class="endpoint-method get">GET</span>
                                <span class="endpoint-path">/agents/{agent_id}/memory/recall</span>
                                <div class="endpoint-desc">get_recall_memory_summary()</div>
                            </div>
                        </div>
                    </div>

                    <!-- SyncServer -->
                    <div class="component-box">
                        <h3>SyncServer</h3>
                        <span class="file-path">mirix/server/server.py</span>

                        <div class="info-box" style="margin-top: 10px; padding: 10px;">
                            Core server class. Manages agents, tools, memory, and coordinates with service managers.
                        </div>

                        <div class="method-list">
                            <div style="color: #4ec9b0; font-weight: 600; margin-bottom: 10px;">Initialization:</div>
                            
                            <div class="method">
                                <div class="method-name">__init__()</div>
                                <div class="method-desc">Creates managers: agent_manager, user_manager, tool_manager, etc.</div>
                            </div>

                            <div style="color: #4ec9b0; font-weight: 600; margin: 20px 0 10px;">Agent Methods:</div>

                            <div class="method">
                                <div class="method-name">create_agent(request, actor)</div>
                                <div class="method-desc">Delegates to agent_manager.create_agent()</div>
                            </div>

                            <div class="method">
                                <div class="method-name">list_agents(user_id)</div>
                                <div class="method-desc">Delegates to agent_manager.list_agents()</div>
                            </div>

                            <div class="method">
                                <div class="method-name">get_agent(agent_id, actor)</div>
                                <div class="method-desc">Delegates to agent_manager.get_agent_by_id()</div>
                            </div>

                            <div class="method">
                                <div class="method-name">delete_agent(agent_id, actor)</div>
                                <div class="method-desc">Delegates to agent_manager.delete_agent()</div>
                            </div>

                            <div style="color: #4ec9b0; font-weight: 600; margin: 20px 0 10px;">Message Methods:</div>

                            <div class="method">
                                <div class="method-name">send_messages(actor, agent_id, messages)</div>
                                <div class="method-desc">Process messages through agent.step()</div>
                            </div>

                            <div class="method">
                                <div class="method-name">get_agent_recall_cursor(user_id, agent_id)</div>
                                <div class="method-desc">Get message history from database</div>
                            </div>

                            <div style="color: #4ec9b0; font-weight: 600; margin: 20px 0 10px;">Memory Methods:</div>

                            <div class="method">
                                <div class="method-name">get_agent_memory(agent_id, actor)</div>
                                <div class="method-desc">Get agent's in-context memory</div>
                            </div>

                            <div class="method">
                                <div class="method-name">update_agent_core_memory(agent_id, label, value)</div>
                                <div class="method-desc">Update core memory block</div>
                            </div>

                            <div class="method">
                                <div class="method-name">get_archival_memory_summary(agent_id)</div>
                                <div class="method-desc">Get archival memory stats</div>
                            </div>

                            <div class="method">
                                <div class="method-name">get_recall_memory_summary(agent_id)</div>
                                <div class="method-desc">Get recall memory stats</div>
                            </div>

                            <div style="color: #4ec9b0; font-weight: 600; margin: 20px 0 10px;">Configuration:</div>

                            <div class="method">
                                <div class="method-name">list_llm_models()</div>
                                <div class="method-desc">Get available LLM configurations</div>
                            </div>

                            <div class="method">
                                <div class="method-name">list_embedding_models()</div>
                                <div class="method-desc">Get available embedding configurations</div>
                            </div>

                            <div style="color: #858585; font-size: 0.85em; margin-top: 15px; text-align: center;">
                                + service managers: agent_manager, user_manager, tool_manager, block_manager, message_manager, and 10+ more...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Endpoints Section -->
            <div id="endpoints" class="section">
                <h2 class="section-title">Complete REST API Endpoints</h2>

                <div class="component-box">
                    <h3>Health & Docs</h3>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/health</span>
                        <div class="endpoint-desc">Health check endpoint</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/docs</span>
                        <div class="endpoint-desc">Swagger UI documentation</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/redoc</span>
                        <div class="endpoint-desc">ReDoc documentation</div>
                    </div>
                </div>

                <div class="component-box">
                    <h3>Agent Endpoints (5)</h3>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/agents</span>
                        <div class="endpoint-desc">List all agents (query params: tags, limit, cursor, parent_id)</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method post">POST</span>
                        <span class="endpoint-path">/agents</span>
                        <div class="endpoint-desc">Create new agent (body: CreateAgentRequest)</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/agents/{agent_id}</span>
                        <div class="endpoint-desc">Get agent by ID</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method patch">PATCH</span>
                        <span class="endpoint-path">/agents/{agent_id}</span>
                        <div class="endpoint-desc">Update agent (body: UpdateAgentRequest)</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method delete">DELETE</span>
                        <span class="endpoint-path">/agents/{agent_id}</span>
                        <div class="endpoint-desc">Delete agent</div>
                    </div>
                </div>

                <div class="component-box">
                    <h3>Message Endpoints (2)</h3>
                    <div class="endpoint">
                        <span class="endpoint-method post">POST</span>
                        <span class="endpoint-path">/agents/{agent_id}/messages</span>
                        <div class="endpoint-desc">Send message to agent (body: SendMessageRequest)</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/agents/{agent_id}/messages</span>
                        <div class="endpoint-desc">Get message history (query params: cursor, limit)</div>
                    </div>
                </div>

                <div class="component-box">
                    <h3>Memory Endpoints (3)</h3>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/agents/{agent_id}/memory</span>
                        <div class="endpoint-desc">Get agent's in-context memory</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/agents/{agent_id}/memory/archival</span>
                        <div class="endpoint-desc">Get archival memory summary</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/agents/{agent_id}/memory/recall</span>
                        <div class="endpoint-desc">Get recall memory summary</div>
                    </div>
                </div>

                <div class="component-box">
                    <h3>Tool Endpoints (4)</h3>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/tools</span>
                        <div class="endpoint-desc">List all tools (query params: cursor, limit)</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/tools/{tool_id}</span>
                        <div class="endpoint-desc">Get tool by ID</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method post">POST</span>
                        <span class="endpoint-path">/tools</span>
                        <div class="endpoint-desc">Create new tool (body: Tool)</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method delete">DELETE</span>
                        <span class="endpoint-path">/tools/{tool_id}</span>
                        <div class="endpoint-desc">Delete tool</div>
                    </div>
                </div>

                <div class="component-box">
                    <h3>Block Endpoints (4)</h3>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/blocks</span>
                        <div class="endpoint-desc">List all blocks (query param: label)</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/blocks/{block_id}</span>
                        <div class="endpoint-desc">Get block by ID</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method post">POST</span>
                        <span class="endpoint-path">/blocks</span>
                        <div class="endpoint-desc">Create new block (body: Block)</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method delete">DELETE</span>
                        <span class="endpoint-path">/blocks/{block_id}</span>
                        <div class="endpoint-desc">Delete block</div>
                    </div>
                </div>

                <div class="component-box">
                    <h3>Configuration Endpoints (2)</h3>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/config/llm</span>
                        <div class="endpoint-desc">List available LLM configurations</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/config/embedding</span>
                        <div class="endpoint-desc">List available embedding configurations</div>
                    </div>
                </div>

                <div class="component-box">
                    <h3>Organization Endpoints (2)</h3>
                    <div class="endpoint">
                        <span class="endpoint-method get">GET</span>
                        <span class="endpoint-path">/organizations</span>
                        <div class="endpoint-desc">List organizations (query params: cursor, limit)</div>
                    </div>
                    <div class="endpoint">
                        <span class="endpoint-method post">POST</span>
                        <span class="endpoint-path">/organizations</span>
                        <div class="endpoint-desc">Create organization (body: name)</div>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <strong>Total:</strong> 30+ REST API endpoints covering agents, messages, memory, tools, blocks, and configuration.
                    All endpoints require authentication via Bearer token or X-User-ID/X-Org-ID headers.
                </div>
            </div>

            <!-- Mapping Section -->
            <div id="mapping" class="section">
                <h2 class="section-title">Method Mapping: Client → API → Server</h2>

                <div class="info-box">
                    This table shows how MirixClient methods map to REST API endpoints and SyncServer methods.
                </div>

                <table class="mapping-table">
                    <thead>
                        <tr>
                            <th style="width: 30%;">MirixClient Method</th>
                            <th style="width: 35%;">REST API Endpoint</th>
                            <th style="width: 35%;">SyncServer Method</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>list_agents()</td>
                            <td>GET /agents</td>
                            <td>agent_manager.list_agents()</td>
                        </tr>
                        <tr>
                            <td>create_agent(...)</td>
                            <td>POST /agents</td>
                            <td>create_agent(CreateAgent, actor)</td>
                        </tr>
                        <tr>
                            <td>get_agent(agent_id)</td>
                            <td>GET /agents/{agent_id}</td>
                            <td>agent_manager.get_agent_by_id()</td>
                        </tr>
                        <tr>
                            <td>update_agent(agent_id, ...)</td>
                            <td>PATCH /agents/{agent_id}</td>
                            <td>agent_manager.update_agent()</td>
                        </tr>
                        <tr>
                            <td>delete_agent(agent_id)</td>
                            <td>DELETE /agents/{agent_id}</td>
                            <td>agent_manager.delete_agent()</td>
                        </tr>
                        <tr>
                            <td>send_message(agent_id, message, role)</td>
                            <td>POST /agents/{agent_id}/messages</td>
                            <td>send_messages(actor, agent_id, messages)</td>
                        </tr>
                        <tr>
                            <td>get_messages(agent_id, cursor, limit)</td>
                            <td>GET /agents/{agent_id}/messages</td>
                            <td>get_agent_recall_cursor()</td>
                        </tr>
                        <tr>
                            <td>get_in_context_memory(agent_id)</td>
                            <td>GET /agents/{agent_id}/memory</td>
                            <td>get_agent_memory(agent_id, actor)</td>
                        </tr>
                        <tr>
                            <td>get_archival_memory_summary(agent_id)</td>
                            <td>GET /agents/{agent_id}/memory/archival</td>
                            <td>get_archival_memory_summary()</td>
                        </tr>
                        <tr>
                            <td>get_recall_memory_summary(agent_id)</td>
                            <td>GET /agents/{agent_id}/memory/recall</td>
                            <td>get_recall_memory_summary()</td>
                        </tr>
                        <tr>
                            <td>list_tools(cursor, limit)</td>
                            <td>GET /tools</td>
                            <td>tool_manager.list_tools()</td>
                        </tr>
                        <tr>
                            <td>get_tool(id)</td>
                            <td>GET /tools/{id}</td>
                            <td>tool_manager.get_tool_by_id()</td>
                        </tr>
                        <tr>
                            <td>delete_tool(id)</td>
                            <td>DELETE /tools/{id}</td>
                            <td>tool_manager.delete_tool_by_id()</td>
                        </tr>
                        <tr>
                            <td>list_blocks(label)</td>
                            <td>GET /blocks</td>
                            <td>block_manager.get_blocks()</td>
                        </tr>
                        <tr>
                            <td>get_block(block_id)</td>
                            <td>GET /blocks/{block_id}</td>
                            <td>block_manager.get_block_by_id()</td>
                        </tr>
                        <tr>
                            <td>create_block(label, value, limit)</td>
                            <td>POST /blocks</td>
                            <td>block_manager.create_or_update_block()</td>
                        </tr>
                        <tr>
                            <td>delete_block(id)</td>
                            <td>DELETE /blocks/{id}</td>
                            <td>block_manager.delete_block()</td>
                        </tr>
                        <tr>
                            <td>list_model_configs()</td>
                            <td>GET /config/llm</td>
                            <td>list_llm_models()</td>
                        </tr>
                        <tr>
                            <td>list_embedding_configs()</td>
                            <td>GET /config/embedding</td>
                            <td>list_embedding_models()</td>
                        </tr>
                        <tr>
                            <td>list_orgs(cursor, limit)</td>
                            <td>GET /organizations</td>
                            <td>organization_manager.list_organizations()</td>
                        </tr>
                        <tr>
                            <td>create_org(name)</td>
                            <td>POST /organizations</td>
                            <td>organization_manager.create_organization()</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Flow Section -->
            <div id="flow" class="section">
                <h2 class="section-title">Request Flow Example</h2>

                <div class="info-box">
                    Detailed walkthrough of what happens when <code>client.send_message()</code> is called
                </div>

                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="flow-step-number">1</div>
                        <div>
                            <strong>User Code</strong>
                            <div class="code-block" style="margin-top: 10px;">
<span class="variable">client</span> = <span class="function">MirixClient</span>(base_url=<span class="string">"http://localhost:8000"</span>)
<span class="variable">response</span> = <span class="variable">client</span>.<span class="function">send_message</span>(
    agent_id=<span class="string">"agent-123"</span>,
    message=<span class="string">"Hello!"</span>,
    role=<span class="string">"user"</span>
)
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-step-number">2</div>
                        <div>
                            <strong>MirixClient.send_message()</strong>
                            <div style="color: #858585; margin-top: 5px;">
                                File: mirix/client/remote_client.py
                            </div>
                            <div class="code-block" style="margin-top: 10px;">
<span class="keyword">def</span> <span class="function">send_message</span>(self, message, role, agent_id, ...):
    request_data = {
        <span class="string">"message"</span>: message,
        <span class="string">"role"</span>: role,
        ...
    }
    data = self.<span class="function">_request</span>(<span class="string">"POST"</span>, <span class="string">f"/agents/{agent_id}/messages"</span>, json=request_data)
    <span class="keyword">return</span> <span class="function">MirixResponse</span>(**data)
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓ HTTP POST</div>

                    <div class="flow-step">
                        <div class="flow-step-number">3</div>
                        <div>
                            <strong>MirixClient._request()</strong>
                            <div class="code-block" style="margin-top: 10px;">
<span class="comment"># Makes HTTP request with retry logic</span>
<span class="keyword">POST</span> http://localhost:8000/agents/agent-123/messages
<span class="keyword">Headers:</span>
    <span class="string">Authorization: Bearer sk-...</span>
    <span class="string">Content-Type: application/json</span>
<span class="keyword">Body:</span>
    { <span class="string">"message"</span>: <span class="string">"Hello!"</span>, <span class="string">"role"</span>: <span class="string">"user"</span>, ... }
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓ Network</div>

                    <div class="flow-step">
                        <div class="flow-step-number">4</div>
                        <div>
                            <strong>FastAPI Endpoint</strong>
                            <div style="color: #858585; margin-top: 5px;">
                                File: mirix/server/rest_api.py
                            </div>
                            <div class="code-block" style="margin-top: 10px;">
@app.<span class="function">post</span>(<span class="string">"/agents/{agent_id}/messages"</span>)
<span class="keyword">async def</span> <span class="function">send_message</span>(
    agent_id: str,
    request: SendMessageRequest,
    auth: AuthContext = <span class="function">Depends</span>(authenticate),
):
    server = <span class="function">get_server</span>()  <span class="comment"># Get SyncServer singleton</span>
    user = server.user_manager.<span class="function">get_user_by_id</span>(auth.user_id)
    ...
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-step-number">5</div>
                        <div>
                            <strong>authenticate()</strong>
                            <div style="color: #858585; margin-top: 5px;">
                                Validates Bearer token or X-User-ID header, returns AuthContext
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-step-number">6</div>
                        <div>
                            <strong>SyncServer.send_messages()</strong>
                            <div style="color: #858585; margin-top: 5px;">
                                File: mirix/server/server.py
                            </div>
                            <div class="code-block" style="margin-top: 10px;">
usage = server.<span class="function">send_messages</span>(
    actor=user,
    agent_id=agent_id,
    input_messages=input_messages,
)
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-step-number">7</div>
                        <div>
                            <strong>AgentManager.get_agent_by_id()</strong>
                            <div style="color: #858585; margin-top: 5px;">
                                Retrieves agent from database via ORM
                            </div>
                            <div class="code-block" style="margin-top: 10px;">
agent = self.agent_manager.<span class="function">get_agent_by_id</span>(agent_id, actor=user)
<span class="comment"># Returns AgentState with all agent configuration</span>
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-step-number">8</div>
                        <div>
                            <strong>Agent.step()</strong>
                            <div style="color: #858585; margin-top: 5px;">
                                File: mirix/agent/agent.py - Agent processes the message
                            </div>
                            <div class="code-block" style="margin-top: 10px;">
<span class="comment"># Agent executes one reasoning step</span>
<span class="comment"># 1. Constructs prompt with memory + message</span>
<span class="comment"># 2. Calls LLM API (OpenAI, Anthropic, etc.)</span>
<span class="comment"># 3. Processes tool calls if any</span>
<span class="comment"># 4. Updates memory</span>
<span class="comment"># 5. Saves messages to database</span>
                            </div>
                        </div>
                    </div>

                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-step-number">9</div>
                        <div>
                            <strong>Response Flows Back</strong>
                            <div class="code-block" style="margin-top: 10px;">
<span class="comment"># FastAPI returns JSON response</span>
<span class="keyword">return</span> <span class="function">MirixResponse</span>(messages=mirix_messages, usage=usage)

<span class="comment"># MirixClient receives and deserializes</span>
<span class="keyword">return</span> <span class="function">MirixResponse</span>(**response.json())

<span class="comment"># User gets the response</span>
<span class="keyword">print</span>(response.messages[-1].text)
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <strong>Performance:</strong> Network latency + LLM API call (500ms-5s) dominates the request time. 
                    The REST API wrapper adds minimal overhead (~1-5ms).
                </div>
            </div>
        </div>
    </div>

    <script>
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));

            const buttons = document.querySelectorAll('.nav-button');
            buttons.forEach(button => button.classList.remove('active'));

            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
